<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ä¹¦å¸æŸ¥è¯¢å·¥å…·</title>
<style>
body{font-family:"Microsoft YaHei",sans-serif;margin:20px;background:#fafafa}
#main{display:none}
#inputData{width:100%;height:200px;font-size:14px;padding:8px;border:1px solid #ccc;border-radius:6px;overflow:auto;background:white;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}
button{padding:6px 14px;margin:8px 4px;border:none;border-radius:6px;background-color:#0078d7;color:white;cursor:pointer;display:inline-flex;align-items:center;height:34px}
button:hover{background-color:#005ea6}
table{border-collapse:collapse;width:100%;margin-top:10px;background:white}
th,td{border:1px solid #ccc;padding:6px;text-align:left;font-size:14px}
th{background-color:#f0f0f0}
#result{margin-top:20px;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}
input[type=number]{height:34px;font-size:14px;padding:0 8px;border:1px solid #ccc;border-radius:6px;vertical-align:middle;display:inline-flex;align-items:center}
</style>
</head>
<body>

<div id="passwordArea">
  <h2>è¯·è¾“å…¥å¯†ç </h2>
  <input type="password" id="pwdInput" placeholder="è¯·è¾“å…¥å¯†ç ">
  <button onclick="checkPwd()">ç¡®å®š</button>
  <p id="pwdMsg" style="color:red;"></p>
</div>

<div id="main">
  <h2>ğŸ“– ä¹¦å¸æŸ¥è¯¢å·¥å…·</h2>
  <p>å¤åˆ¶<a href="https://docs.qq.com/sheet/DUHFGbE54d0JDcWFT?tab=1i6wf3" target="_blank">å®æ—¶æ±‡æ€»è¡¨</a>ç²˜è´´è‡³æ­¤å¤„ï¼ˆæ³¨æ„ä¸è¦ç²˜è´´ä¸ºçº¯æ–‡æœ¬ï¼‰ï¼š</p>
  <div id="inputData" contenteditable="true" placeholder="ç²˜è´´è¡¨æ ¼å†…å®¹â€¦"></div>

  <br>
  <input type="number" id="numInput" placeholder="è¾“å…¥æ‰€éœ€ä¹¦å¸">
  <button onclick="search()">æŸ¥è¯¢</button>
  <button onclick="copyResult()">å¤åˆ¶åå•</button>
  <button onclick="copyTableImg()">å¤åˆ¶è¡¨æ ¼ä¸ºå›¾ç‰‡</button>
  <button onclick="downloadTableImg()">å¯¼å‡ºè¡¨æ ¼ä¸ºå›¾ç‰‡</button>
  <div id="result"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
(function(){
const PASSWORD="weread500bookcoin",STORAGE_KEY="wenxindushu_pwd_ok";let latestResult=[],parsedTableHTML="";
window.checkPwd=function(){let v=document.getElementById("pwdInput").value.trim();if(v===PASSWORD){localStorage.setItem(STORAGE_KEY,"true");showMain()}else{document.getElementById("pwdMsg").innerText="âŒ å¯†ç é”™è¯¯"}};
function showMain(){document.getElementById("passwordArea").style.display="none";document.getElementById("main").style.display="block"}
window.onload=function(){localStorage.getItem(STORAGE_KEY)==="true"&&showMain()};
function formatUpdateTime(s){if(!s)return"";let d=new Date(s.replace(/-/g,'/'));if(isNaN(d))return s;let now=new Date(),diff=Math.floor((now-d)/(864e5));return diff===0?"ä»Šæ—¥å†…":diff+"å¤©å‰"}
const inputDiv=document.getElementById("inputData");
inputDiv.addEventListener("paste",e=>{e.preventDefault();let d=e.clipboardData||window.clipboardData,h=d.getData("text/html"),t=d.getData("text/plain");if(h&&h.includes("<table"))inputDiv.innerHTML=h;else{let r="<table><tbody>";for(const l of t.trim().split(/\r?\n/)){r+="<tr>"+l.split(/\s+/).map(c=>`<td>${c}</td>`).join("")+"</tr>"}r+="</tbody></table>";inputDiv.innerHTML=r}parsedTableHTML=inputDiv.innerHTML});
window.search=function(){const num=parseFloat(document.getElementById("numInput").value),table=inputDiv.querySelector("table");if(!inputDiv.innerHTML.trim()){alert("è¯·å…ˆç²˜è´´è¡¨æ ¼æ•°æ®");return}if(isNaN(num)){alert("è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—");return}if(!table){alert("è¯·ç²˜è´´åŒ…å«è¡¨æ ¼çš„å†…å®¹");return}const rows=Array.from(table.rows).slice(1);let result=[];for(const r of rows){const c=r.cells;if(c.length<6)continue;const name=c[0].innerText.trim(),accounts=[c[1].innerText.trim(),c[2].innerText.trim(),c[3].innerText.trim(),c[4].innerText.trim()],submit=c[5].innerText.trim();for(let i=0;i<accounts.length;i++){const t=accounts[i];if(!t)continue;const m=t.match(/\d+(\.\d+)?/),v=m?parseFloat(m[0]):null;v!==null&&v>=num-2&&v<=num+5&&result.push({ç¾¤æ˜µç§°:name,è´¦å·:`è´¦å·${i+1}`,ä¹¦å¸:t,æäº¤æ—¶é—´:formatUpdateTime(submit),æ˜¯å¦è¿‡æœŸ:/è¿‡æœŸ|åˆ°æœŸ/.test(t),æ˜¯å¦å®Œç¾åŒ¹é…:v===num,æ•°å€¼:v})}}result.sort((a,b)=>a.æ˜¯å¦è¿‡æœŸ&&!b.æ˜¯å¦è¿‡æœŸ?-1:!a.æ˜¯å¦è¿‡æœŸ&&b.æ˜¯å¦è¿‡æœŸ?1:a.æ•°å€¼-b.æ•°å€¼);if(result.length<=1){let expired=[],normal=[];for(const r of rows){const c=r.cells;if(c.length<6)continue;const name=c[0].innerText.trim(),accounts=[c[1].innerText.trim(),c[2].innerText.trim(),c[3].innerText.trim(),c[4].innerText.trim()],submit=c[5].innerText.trim();for(let i=0;i<accounts.length;i++){const t=accounts[i];if(!t)continue;const m=t.match(/\d+(\.\d+)?/),v=m?parseFloat(m[0]):null;if(v!==null&&v>num){const item={ç¾¤æ˜µç§°:name,è´¦å·:`è´¦å·${i+1}`,ä¹¦å¸:t,æäº¤æ—¶é—´:formatUpdateTime(submit),æ˜¯å¦è¿‡æœŸ:/è¿‡æœŸ|åˆ°æœŸ/.test(t),æ˜¯å¦å®Œç¾åŒ¹é…:v===num,æ•°å€¼:v};item.æ˜¯å¦è¿‡æœŸ?expired.push(item):normal.push(item)}}}normal.sort((a,b)=>a.æ•°å€¼-b.æ•°å€¼);normal=normal.slice(0,3);result=[...expired,...normal];result.sort((a,b)=>a.æ˜¯å¦è¿‡æœŸ&&!b.æ˜¯å¦è¿‡æœŸ?-1:!a.æ˜¯å¦è¿‡æœŸ&&b.æ˜¯å¦è¿‡æœŸ?1:a.æ•°å€¼-b.æ•°å€¼)}latestResult=result;const resDiv=document.getElementById("result");if(result.length===0){resDiv.innerHTML="<p>âŒ æœªæ‰¾åˆ°åŒ¹é…ç»“æœ</p>";return}let html="<table><tr><th>ç¾¤æ˜µç§°</th><th>è´¦å·</th><th>ä¹¦å¸</th><th>æ›´æ–°æ—¶é—´</th></tr>";for(const r of result){let style="";r.æ˜¯å¦è¿‡æœŸ&&(style+="color:red;font-weight:bold;");r.æ˜¯å¦å®Œç¾åŒ¹é…&&(style+="background:yellow;");html+=`<tr><td>${r.ç¾¤æ˜µç§°}</td><td>${r.è´¦å·}</td><td style="${style}">${r.ä¹¦å¸}</td><td>${r.æäº¤æ—¶é—´}</td></tr>`}html+="</table>";resDiv.innerHTML=html};
window.copyResult=function(){if(!latestResult||latestResult.length===0){alert("æ— å†…å®¹å¯å¤åˆ¶");return}const names=[...new Set(latestResult.map(r=>r.ç¾¤æ˜µç§°))].join("\n");navigator.clipboard.writeText(names).then(()=>alert("âœ… åå•å·²å¤åˆ¶")).catch(()=>{let ta=document.createElement("textarea");ta.value=names;document.body.appendChild(ta);ta.select();document.execCommand("copy");document.body.removeChild(ta);alert("âœ… åå•å·²å¤åˆ¶")})};
window.downloadTableImg=function(){const table=document.querySelector("#result table");if(!table){alert("æ— è¡¨æ ¼å¯å¯¼å‡º");return}html2canvas(table).then(canvas=>{let a=document.createElement("a");a.download="æŸ¥è¯¢ç»“æœ.png";a.href=canvas.toDataURL();a.click()})};
window.copyTableImg=async function(){const table=document.querySelector("#result table");if(!table){alert("æ— è¡¨æ ¼å¯å¤åˆ¶");return}try{const canvas=await html2canvas(table);canvas.toBlob(async blob=>{if(!blob){alert("ç”Ÿæˆå›¾ç‰‡å¤±è´¥");return}try{await navigator.clipboard.write([new ClipboardItem({"image/png":blob})]);alert("âœ… è¡¨æ ¼å·²å¤åˆ¶ä¸ºå›¾ç‰‡ï¼Œå¯ç›´æ¥ç²˜è´´åˆ°å¾®ä¿¡")}catch(e){let a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="è¡¨æ ¼.png";a.click();alert("âœ… å›¾ç‰‡å·²ä¸‹è½½")}})}catch(e){alert("âŒ ç”Ÿæˆå›¾ç‰‡å¤±è´¥");console.error(e)}};
})();
</script>
</body>
</html>
