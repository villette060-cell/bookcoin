<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>ä¹¦å¸æŸ¥è¯¢å·¥å…·</title><style>body{font-family:"Microsoft YaHei",sans-serif;margin:20px;background:#fafafa}#main{display:none}#inputData{width:100%;height:200px;font-size:14px;padding:8px;border:1px solid #ccc;border-radius:6px;overflow:auto;background:white;box-sizing:border-box}.inputArea{text-align:left}button{padding:6px 14px;margin:8px 4px;border:none;border-radius:6px;background-color:#0078d7;color:white;cursor:pointer;display:inline-flex;align-items:center;height:34px;white-space:nowrap}button:hover{background-color:#005ea6}table{border-collapse:collapse;width:100%;margin-top:10px;background:white}th,td{border:1px solid #ccc;padding:6px;text-align:left;font-size:14px}th{background-color:#f0f0f0}#result{margin-top:20px;overflow:auto}pre{width:100%;background:#f9f9f9;border:1px solid #ccc;border-radius:6px;padding:8px;white-space:pre-wrap}input[type=number]{height:34px;font-size:14px;padding:0 8px;border:1px solid #ccc;border-radius:6px;vertical-align:middle;display:inline-flex;align-items:center}#actionButtons{display:flex;justify-content:center;flex-wrap:wrap;margin-top:10px}#actionButtons button{flex:0 0 auto}.queryValue{font-weight:bold;margin-bottom:6px;text-align:center}</style></head><body><div id="passwordArea" style="text-align:center"><h2>è¯·è¾“å…¥å¯†ç </h2><input type="password" id="pwdInput" placeholder="è¯·è¾“å…¥å¯†ç "><button onclick="checkPwd()">ç¡®å®š</button><p id="pwdMsg" style="color:red"></p></div><div id="main" style="text-align:center"><h2>ğŸ“– ä¹¦å¸æŸ¥è¯¢å·¥å…·</h2><div class="inputArea"><p>å¤åˆ¶<a href="https://docs.qq.com/sheet/DUHFGbE54d0JDcWFT?tab=1i6wf3" target="_blank">å®æ—¶æ±‡æ€»è¡¨</a>ç²˜è´´è‡³æ­¤å¤„ï¼ˆæ³¨æ„ä¸è¦ç²˜è´´ä¸ºçº¯æ–‡æœ¬ï¼‰ï¼š</p><div id="inputData" contenteditable="true" placeholder="ç²˜è´´è¡¨æ ¼å†…å®¹â€¦"></div></div><div style="margin:10px 0"><input type="number" id="numInput" placeholder="è¾“å…¥æ‰€éœ€ä¹¦å¸"><button onclick="search()">æŸ¥è¯¢</button></div><div id="result"></div><div id="actionButtons" style="display:none"><button onclick="copyResult()">å¤åˆ¶åå•</button><button onclick="copyTableImg()">å¤åˆ¶æŸ¥è¯¢ç»“æœ</button><button onclick="downloadTableImg()">å¯¼å‡ºæŸ¥è¯¢ç»“æœ</button></div></div><script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script><script>const _enc=[122,104,127,104,108,105,56,61,61,111,98,98,102,110,98,100,99],_key=13,_dec=()=>_enc.map(x=>String.fromCharCode(x^_key)).join('');const STORAGE_KEY="wenxindushu_pwd_ok";let latestResult=[];function checkPwd(){let v=document.getElementById("pwdInput").value.trim();v===_dec()?(localStorage.setItem(STORAGE_KEY,"true"),showMain()):document.getElementById("pwdMsg").innerText="âŒ å¯†ç é”™è¯¯"}function showMain(){document.getElementById("passwordArea").style.display="none";document.getElementById("main").style.display="block"}window.onload=function(){localStorage.getItem(STORAGE_KEY)==="true"&&showMain()};function fmtT(a){if(!a)return"";let d=new Date(a.replace(/-/g,'/'));if(isNaN(d))return a;let s=new Date(d.getFullYear(),d.getMonth(),d.getDate()),n=new Date(),t=new Date(n.getFullYear(),n.getMonth(),n.getDate()),r=Math.floor((t-s)/864e5);return r===0?"ä»Šæ—¥å†…":r+"å¤©å‰"}const inputDiv=document.getElementById("inputData");inputDiv.addEventListener("paste",e=>{e.preventDefault();let t=e.clipboardData||window.clipboardData,h=t.getData("text/html"),s=t.getData("text/plain");if(h&&h.includes("<table"))inputDiv.innerHTML=h;else{let rows=s.trim().split(/\r?\n/).map(r=>r.trim().split(/\s+/)).filter(r=>r[0]&&r[1]&&r[5]),H="<table><tbody>";for(const r of rows)H+="<tr>"+r.map(c=>`<td>${c}</td>`).join('')+"</tr>";H+="</tbody></table>";inputDiv.innerHTML=H}});function search(){const cont=document.getElementById("inputData"),num=parseFloat(document.getElementById("numInput").value);if(!cont.innerHTML.trim()){alert("è¯·å…ˆç²˜è´´è¡¨æ ¼æ•°æ®");return}if(isNaN(num)){alert("è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—");return}const tbl=cont.querySelector("table");if(!tbl){alert("è¯·ç²˜è´´åŒ…å«è¡¨æ ¼çš„å†…å®¹");return}const rows=Array.from(tbl.rows).slice(1),parseRow=r=>{const res=[],cells=r.cells;if(cells.length<6)return[];const name=cells[0].innerText.trim(),acc=[cells[1].innerText.trim(),cells[2].innerText.trim(),cells[3].innerText.trim(),cells[4].innerText.trim()],sub=cells[5].innerText.trim();acc.forEach((t,i)=>{if(!t)return;let m=t.match(/\d+(\.\d+)?/),v=m?parseFloat(m[0]):null;v!==null&&res.push({ç¾¤æ˜µç§°:name,è´¦å·:`è´¦å·${i+1}`,ä¹¦å¸:t,æäº¤æ—¶é—´:fmtT(sub),æ˜¯å¦è¿‡æœŸ:/è¿‡æœŸ|åˆ°æœŸ/.test(t),æ˜¯å¦æ”’:/æ”’/.test(t),æ•°å€¼:v,åŸå§‹æ—¶é—´:sub})});return res},toTS=s=>{if(!s)return 0;const d=new Date(s.replace(/-/g,'/'));return isNaN(d)?0:d.getTime()},sortR=a=>a.sort((x,y)=>x.æ˜¯å¦è¿‡æœŸ&&!y.æ˜¯å¦è¿‡æœŸ?-1:!x.æ˜¯å¦è¿‡æœŸ&&y.æ˜¯å¦è¿‡æœŸ?1:x.æ˜¯å¦æ”’&&!y.æ˜¯å¦æ”’?1:!x.æ˜¯å¦æ”’&&y.æ˜¯å¦æ”’?-1:x.æ•°å€¼-y.æ•°å€¼||toTS(y.åŸå§‹æ—¶é—´)-toTS(x.åŸå§‹æ—¶é—´)),sortA=a=>a.sort((x,y)=>x.æ•°å€¼-y.æ•°å€¼),sortD=a=>a.sort((x,y)=>y.æ•°å€¼-x.æ•°å€¼);let expired=[],below=[],range=[],above=[],zhan=[];rows.forEach(rw=>{parseRow(rw).forEach(it=>{if(it.æ˜¯å¦æ”’){if((it.æ•°å€¼>=num-2&&it.æ•°å€¼<num)||(it.æ•°å€¼>=num&&it.æ•°å€¼<=num+5)||(it.æ•°å€¼>=num-10&&it.æ•°å€¼<num-2))zhan.push(it);return}it.æ•°å€¼>=num-2&&/è¿‡æœŸ|åˆ°æœŸ/.test(it.ä¹¦å¸)&&expired.push(it);it.æ•°å€¼>=num-2&&it.æ•°å€¼<num&&below.push(it);it.æ•°å€¼>=num&&it.æ•°å€¼<=num+5&&range.push(it);it.æ•°å€¼>num+5&&above.push(it)})});sortD(below);sortA(range);sortA(above);below=below.slice(0,2);let choose=[...range];if(choose.length<3){choose.push(...above.slice(0,3-choose.length))}let first=[...expired,...below,...choose],seen=new Set;first=first.filter(x=>{let k=x.ç¾¤æ˜µç§°+x.è´¦å·+x.ä¹¦å¸;if(seen.has(k))return!1;seen.add(k);return!0});if(first.length<3){let more=[];rows.forEach(rw=>{parseRow(rw).forEach(it=>{if(!it.æ˜¯å¦æ”’&&it.æ•°å€¼>=num-10&&it.æ•°å€¼<num-2)more.push(it)})});sortD(more);first.push(...more.slice(0,3))}let final=sortR(first);if(final.length<3&&zhan.length>0){final.push(...sortR(zhan).slice(0,3-final.length));final=sortR(final)};const minGE=final.filter(x=>x.æ•°å€¼>=num&&!x.æ˜¯å¦æ”’).reduce((a,x)=>a===null?x.æ•°å€¼:Math.min(a,x.æ•°å€¼),null);latestResult=final;const out=document.getElementById("result"),act=document.getElementById("actionButtons");if(final.length===0){out.innerHTML="<p>âŒ æœªæ‰¾åˆ°åŒ¹é…ç»“æœ</p>";act.style.display="none";return}let outHtml=`<div class="queryValue">æŸ¥è¯¢å€¼ï¼š${num}</div><table><tr><th>ç¾¤æ˜µç§°</th><th>è´¦å·</th><th>ä¹¦å¸</th><th>æ›´æ–°æ—¶é—´</th></tr>`;final.forEach(r=>{let s="";r.æ˜¯å¦è¿‡æœŸ&&(s+="color:red;font-weight:bold;");r.æ˜¯å¦æ”’&&(s+="color:gray;");minGE!==null&&r.æ•°å€¼===minGE&&!r.æ˜¯å¦æ”’&&(s+="background:yellow;");outHtml+=`<tr><td>${r.ç¾¤æ˜µç§°}</td><td>${r.è´¦å·}</td><td style="${s}">${r.ä¹¦å¸}</td><td>${r.æäº¤æ—¶é—´}</td></tr>`});outHtml+="</table>";out.innerHTML=outHtml;act.style.display="flex"}function copyResult(){if(!latestResult||latestResult.length===0){alert("æ— å†…å®¹å¯å¤åˆ¶");return}navigator.clipboard.writeText([...new Set(latestResult.map(x=>x.ç¾¤æ˜µç§°))].join("\n")).then(()=>alert("âœ… åå•å·²å¤åˆ¶"))}function downloadTableImg(){const a=document.getElementById("result");if(!a){alert("æ— æŸ¥è¯¢ç»“æœå¯å¯¼å‡º");return}html2canvas(a).then(c=>{let link=document.createElement("a");link.download="æŸ¥è¯¢ç»“æœ.png";link.href=c.toDataURL();link.click()})}async function copyTableImg(){const a=document.getElementById("result");if(!a){alert("æ— æŸ¥è¯¢ç»“æœå¯å¤åˆ¶");return}try{const c=await html2canvas(a);c.toBlob(async b=>{if(!b){alert("ç”Ÿæˆå›¾ç‰‡å¤±è´¥");return}try{await navigator.clipboard.write([new ClipboardItem({"image/png":b})]);alert("âœ… æŸ¥è¯¢ç»“æœå·²å¤åˆ¶ä¸ºå›¾ç‰‡ï¼Œå¯ç›´æ¥ç²˜è´´åˆ°å¾®ä¿¡")}catch(e){alert("âŒ å¤åˆ¶å¤±è´¥");console.error(e)}})}catch(e){alert("âŒ ç”Ÿæˆå›¾ç‰‡å¤±è´¥");console.error(e)}}</script></body></html>
