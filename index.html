<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>ä¹¦å¸æŸ¥è¯¢å·¥å…·</title><style>body{font-family:"Microsoft YaHei",sans-serif;margin:20px;background:#fafafa}#main{display:none}#inputData{width:100%;height:200px;font-size:14px;padding:8px;border:1px solid #ccc;border-radius:6px;overflow:auto;background:white}button{padding:6px 14px;margin:8px 4px;border:none;border-radius:6px;background-color:#0078d7;color:white;cursor:pointer;display:inline-flex;align-items:center;height:34px}button:hover{background-color:#005ea6}table{border-collapse:collapse;width:100%;margin-top:10px;background:white}th,td{border:1px solid #ccc;padding:6px;text-align:left;font-size:14px}th{background-color:#f0f0f0}#result{margin-top:20px}pre{width:100%;background:#f9f9f9;border:1px solid #ccc;border-radius:6px;padding:8px;white-space:pre-wrap}input[type=number]{height:34px;font-size:14px;padding:0 8px;border:1px solid #ccc;border-radius:6px;vertical-align:middle;display:inline-flex;align-items:center}</style></head><body><div id="passwordArea"><h2>è¯·è¾“å…¥å¯†ç </h2><input type="password" id="pwdInput" placeholder="è¯·è¾“å…¥å¯†ç "><button onclick="checkPwd()">ç¡®å®š</button><p id="pwdMsg" style="color:red;"></p></div><div id="main"><h2>ğŸ“– ä¹¦å¸æŸ¥è¯¢å·¥å…·</h2><p>å¤åˆ¶<a href="https://docs.qq.com/sheet/DUHFGbE54d0JDcWFT?tab=1i6wf3" target="_blank">å®æ—¶æ±‡æ€»è¡¨</a>ç²˜è´´è‡³æ­¤å¤„ï¼ˆæ³¨æ„ä¸è¦ç²˜è´´ä¸ºçº¯æ–‡æœ¬ï¼‰ï¼š</p><div id="inputData" contenteditable="true" placeholder="ç²˜è´´è¡¨æ ¼å†…å®¹â€¦"></div><br><input type="number" id="numInput" placeholder="è¾“å…¥æ‰€éœ€ä¹¦å¸"><button onclick="search()">æŸ¥è¯¢</button><button onclick="copyResult()">å¤åˆ¶åå•</button><button onclick="copyTableImg()">å¤åˆ¶è¡¨æ ¼ä¸ºå›¾ç‰‡</button><button onclick="downloadTableImg()">å¯¼å‡ºè¡¨æ ¼ä¸ºå›¾ç‰‡</button><div id="result"></div></div><script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script><script>const P="weread500bookcoin",K="wenxindushu_pwd_ok";let R=[];function checkPwd(){let a=document.getElementById("pwdInput").value.trim();a===P?(localStorage.setItem(K,"true"),showMain()):document.getElementById("pwdMsg").innerText="âŒ å¯†ç é”™è¯¯"}function showMain(){document.getElementById("passwordArea").style.display="none";document.getElementById("main").style.display="block"}window.onload=function(){localStorage.getItem(K)==="true"&&showMain()};function fmtT(a){if(!a)return"";let b=new Date(a.replace(/-/g,'/'));if(isNaN(b))return a;let c=new Date(b.getFullYear(),b.getMonth(),b.getDate()),d=new Date(),e=new Date(d.getFullYear(),d.getMonth(),d.getDate()),f=Math.floor((e-c)/864e5);return f===0?"ä»Šæ—¥å†…":f+"å¤©å‰"}const inDiv=document.getElementById("inputData");inDiv.addEventListener("paste",e=>{e.preventDefault();let t=e.clipboardData||window.clipboardData,h=t.getData("text/html"),s=t.getData("text/plain");if(h&&h.includes("<table"))inDiv.innerHTML=h;else{let r=s.trim().split(/\r?\n/).map(r=>r.trim().split(/\s+/)).filter(r=>r[0]&&r[1]&&r[5]),H="<table><tbody>";for(const i of r)H+="<tr>"+i.map(i=>`<td>${i}</td>`).join('')+"</tr>";H+="</tbody></table>";inDiv.innerHTML=H}});function search(){const a=document.getElementById("inputData"),b=parseFloat(document.getElementById("numInput").value);if(!a.innerHTML.trim()){alert("è¯·å…ˆç²˜è´´è¡¨æ ¼æ•°æ®");return}if(isNaN(b)){alert("è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—");return}const c=a.querySelector("table");if(!c){alert("è¯·ç²˜è´´åŒ…å«è¡¨æ ¼çš„å†…å®¹");return}const d=Array.from(c.rows).slice(1),parseRow=r=>{const t=[],e=r.cells;if(e.length<6)return[];const n=e[0].innerText.trim(),f=[e[1].innerText.trim(),e[2].innerText.trim(),e[3].innerText.trim(),e[4].innerText.trim()],g=e[5].innerText.trim();f.forEach((h,i)=>{if(!h)return;let j=h.match(/\d+(\.\d+)?/),k=j?parseFloat(j[0]):null;k!==null&&t.push({ç¾¤æ˜µç§°:n,è´¦å·:`è´¦å·${i+1}`,ä¹¦å¸:h,æäº¤æ—¶é—´:fmtT(g),æ˜¯å¦è¿‡æœŸ:/è¿‡æœŸ|åˆ°æœŸ/.test(h),æ˜¯å¦å®Œç¾åŒ¹é…:k===b,æ•°å€¼:k})});return t},sortAsc=e=>e.sort((a,b)=>a.æ•°å€¼-b.æ•°å€¼),sortDesc=e=>e.sort((a,b)=>b.æ•°å€¼-a.æ•°å€¼),sortResult=e=>e.sort((a,b)=>a.æ˜¯å¦è¿‡æœŸ&&!b.æ˜¯å¦è¿‡æœŸ?-1:!a.æ˜¯å¦è¿‡æœŸ&&b.æ˜¯å¦è¿‡æœŸ?1:a.æ•°å€¼-b.æ•°å€¼);let L=[],M=[],N=[],O=[];d.forEach(r=>{parseRow(r).forEach(i=>{i.æ•°å€¼>=b-2&&i.æ•°å€¼<b?M.push(i):i.æ•°å€¼>=b&&i.æ•°å€¼<=b+5?N.push(i):i.æ•°å€¼>b+5&&O.push(i);/è¿‡æœŸ|åˆ°æœŸ/.test(i.ä¹¦å¸)&&i.æ•°å€¼>=b-2&&L.push(i)})});sortDesc(M);sortAsc(N);sortAsc(O);M=M.slice(0,2);let P1=[...N];if(P1.length<3){P1.push(...O.slice(0,3-P1.length))}let combined=[...L,...M,...P1],seen=new Set;combined=combined.filter(i=>{let k=i.ç¾¤æ˜µç§°+i.è´¦å·+i.ä¹¦å¸;if(seen.has(k))return!1;seen.add(k);return!0});if(combined.length<3){let extra=[];d.forEach(r=>{parseRow(r).forEach(i=>{i.æ•°å€¼>=b-10&&i.æ•°å€¼<b-2&&extra.push(i)})});sortDesc(extra);combined.push(...extra.slice(0,3))}let finalResult=sortResult(combined);const minGE=finalResult.filter(r=>r.æ•°å€¼>=b).reduce((a,r)=>a===null?r.æ•°å€¼:Math.min(a,r.æ•°å€¼),null);R=finalResult;const resDiv=document.getElementById("result");if(finalResult.length===0){resDiv.innerHTML="<p>âŒ æœªæ‰¾åˆ°åŒ¹é…ç»“æœ</p>";return}let html="<table><tr><th>ç¾¤æ˜µç§°</th><th>è´¦å·</th><th>ä¹¦å¸</th><th>æ›´æ–°æ—¶é—´</th></tr>";finalResult.forEach(r=>{let s="";r.æ˜¯å¦è¿‡æœŸ&&(s+="color:red;font-weight:bold;");r.æ•°å€¼===minGE&&(s+="background:yellow;");html+=`<tr><td>${r.ç¾¤æ˜µç§°}</td><td>${r.è´¦å·}</td><td style="${s}">${r.ä¹¦å¸}</td><td>${r.æäº¤æ—¶é—´}</td></tr>`});html+="</table>";resDiv.innerHTML=html}function copyResult(){if(!R||R.length===0){alert("æ— å†…å®¹å¯å¤åˆ¶");return}navigator.clipboard.writeText([...new Set(R.map(r=>r.ç¾¤æ˜µç§°))].join("\n")).then(()=>alert("âœ… åå•å·²å¤åˆ¶"))}function downloadTableImg(){const a=document.querySelector("#result table");if(!a){alert("æ— è¡¨æ ¼å¯å¯¼å‡º");return}html2canvas(a).then(b=>{let c=document.createElement("a");c.download="æŸ¥è¯¢ç»“æœ.png";c.href=b.toDataURL();c.click()})}async function copyTableImg(){const a=document.querySelector("#result table");if(!a){alert("æ— è¡¨æ ¼å¯å¤åˆ¶");return}try{const b=await html2canvas(a);b.toBlob(async c=>{if(!c){alert("ç”Ÿæˆå›¾ç‰‡å¤±è´¥");return}try{await navigator.clipboard.write([new ClipboardItem({"image/png":c})]);alert("âœ… è¡¨æ ¼å·²å¤åˆ¶ä¸ºå›¾ç‰‡ï¼Œå¯ç›´æ¥ç²˜è´´åˆ°å¾®ä¿¡")}catch(e){alert("âŒ å¤åˆ¶å¤±è´¥");console.error(e)}})}catch(e){alert("âŒ ç”Ÿæˆå›¾ç‰‡å¤±è´¥");console.error(e)}}</script></body></html>
