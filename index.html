<!DOCTYPE html>
<html lang="zh"><head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ä¹¦å¸æŸ¥è¯¢å·¥å…·v3.0</title>
<style>
#passwordArea {
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
text-align: center;
}
#pwdInput {
width: 240px;
height: 34px;
padding: 0 8px;
font-size: 18px;
border: 1px solid #ccc;
border-radius: 6px;
box-sizing: border-box;
text-align: left;
}
#pwdConfirm {
margin-top: 10px;
padding: 6px 14px;
border: none;
border-radius: 6px;
background-color: #0078d7;
color: white;
cursor: pointer;
height: 34px;
font-size: 14px;
}
#pwdConfirm:hover {
background-color: #005ea6;
}
body {
font-family: "Microsoft YaHei", sans-serif;
margin: 20px;
background: #fafafa;
}
#main {
display: none;
text-align: center;
}
#inputWrapper {
position: relative;
width: 100%;
max-width: 100%;
height: 250px;
margin-bottom: 10px;
}
#placeholderText {
position: absolute;
top: 8px;
left: 8px;
color: #999;
pointer-events: none;
}
#inputData {
width: 100%;
height: 100%;
overflow-y: auto;
border: 1px solid #ccc;
border-radius: 6px;
padding: 8px;
box-sizing: border-box;
font-size: 14px;
line-height: 1.6;
white-space: pre-wrap;
text-align: left;
}
button {
padding: 6px 14px;
margin: 8px 4px;
border: none;
border-radius: 6px;
background-color: #0078d7;
color: white;
cursor: pointer;
display: inline-flex;
align-items: center;
height: 34px;
white-space: nowrap;
transition: background-color 0.12s;
}
button:hover {
background-color: #005ea6;
}
button.loading {
background-color: #999;
cursor: not-allowed;
}
table {
border-collapse: collapse;
width: 100%;
margin-top: 10px;
background: white;
}
th,
td {
border: 1px solid #ccc;
padding: 6px;
text-align: left;
font-size: 14px;
vertical-align: middle;
}
th {
background-color: #f0f0f0;
}
#result {
margin-top: 20px;
overflow: auto;
position: relative;
background: transparent;
}
pre {
width: 100%;
background: #f9f9f9;
border: 1px solid #ccc;
border-radius: 6px;
padding: 8px;
white-space: pre-wrap;
}
#numInput {
font-weight: 600;
width: 100px;
height: 34px;
text-align: center;
padding: 0 8px;
border: 1px solid #ccc;
border-radius: 6px;
vertical-align: middle;
font-size: 18px;
-moz-appearance: textfield;
}
#numInput::-webkit-outer-spin-button,
#numInput::-webkit-inner-spin-button {
-webkit-appearance: none;
margin: 0;
}
#numInput::placeholder {
text-align: center;
font-weight: normal;
font-size: 14px;
}
#actionButtons {
display: flex;
justify-content: center;
flex-wrap: wrap;
margin-top: 10px;
}
#actionButtons button {
flex: 0 0 auto;
}
.queryValue {
font-weight: bold;
margin-bottom: 6px;
text-align: center;
}
.statusText {
font-size: 14px;
color: #666;
margin-top: 5px;
}
.trashSvg {
width: 18px;
height: 18px;
cursor: pointer;
display: inline-block;
vertical-align: middle;
}
.trashCell {
text-align: center;
}
@media (max-width:420px) {
button {
padding: 6px 10px;
font-size: 13px;
}
.trashSvg {
width: 16px;
height: 16px;
}
}
.deleted-mark {
opacity: 0.45;
text-decoration: line-through;
}
.highlight-row {
background: yellow !important;
}
#dealAndTransfer {
display: flex;
flex-wrap: wrap;
font-size: 16px;
align-items: center;
column-gap: 10px;
font-weight: 600;
}
#dealAndTransfer .item {
flex: 1 1 auto;
min-width: 120px;
}
@media (max-width:768px) {
#dealAndTransfer {
justify-content: center;
}
#dealAndTransfer .item:nth-child(1),
#dealAndTransfer .item:nth-child(2) {
flex: 1 1 45%;
text-align: center;
margin-bottom: 0;
}
#dealAndTransfer .item:nth-child(3),
#dealAndTransfer .item:nth-child(4) {
flex: 1 1 45%;
text-align: center;
margin-top: 0;
}
}
#result table tr {
height: 30px;
}
#result table td {
height: 30px;
line-height: 20px;
overflow: hidden;
white-space: nowrap;
text-overflow: ellipsis;
padding: 0 4px;
vertical-align: middle;
}
@media screen and (max-width: 768px) {
#result table tr {
height: 50px;
}
#result table td {
height: 50px;
padding: 0 4px;
vertical-align: middle;
}
#result table td .multi-line {
display: -webkit-box;
-webkit-box-orient: vertical;
-webkit-line-clamp: 3;
overflow: hidden;
line-height: 20px;
height: 60px;
white-space: normal;
text-overflow: ellipsis;
display: -webkit-box;
justify-content: center;
}
}
.page-container {
display: none;
}
.page-container.active {
display: block;
}
#groupSortPage.active {
display: flex;
}
#groupSortPage {
padding: 10px;
}
#groupSortTableWrapper {
overflow-x: auto;
overflow-y: auto;
margin-bottom: 20px;
}
#groupSortPage {
flex-direction: column;
height: calc(100vh - 40px);
padding: 0 20px 20px 20px;
box-sizing: border-box;
}
#groupSortPage .page-header,
#groupSortPage #groupSortTopBar {
flex-shrink: 0;
}
#groupSortPage #groupSortTableWrapper {
flex: 1;
overflow-y: auto;
overflow-x: auto;
min-height: 0;
margin-top: 10px;
}
#groupSortTable thead th {
position: sticky;
top: 0;
z-index: 10;
background-color: white !important;
}
#groupSortTable {
border-collapse: collapse;
background: white;
table-layout: fixed;
}
#groupSortTable th,
#groupSortTable td {
border: 1px solid #ccc;
padding: 0;
text-align: center;
font-size: 12px;
width: 120px;
min-width: 120px;
max-width: 120px;
height: 20px;
min-height: 20px;
max-height: 20px;
line-height: 20px;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
box-sizing: border-box;
}
#groupSortTable th {
background-color: white;
font-weight: bold;
height: 25px;
min-height: 25px;
max-height: 25px;
line-height: 25px;
font-size: 13px;
}
#groupSortTable .group-header {
background-color: #e0e0e0;
font-weight: bold;
}
#groupSortTable .group-header[colspan] {
text-align: center;
}
.page-header {
display: flex;
justify-content: center;
align-items: center;
margin-bottom: 24px;
padding: 0 20px;
position: relative;
min-height: 50px;
}
.page-header h2 {
margin: 0;
text-align: left;
}
.page-tabs {
display: flex;
gap: 0;
justify-content: center;
align-items: center;
background: transparent;
padding: 0;
border-radius: 0;
box-shadow: none;
}
.page-tab {
padding: 12px 32px;
cursor: pointer;
color: #666;
font-size: 18px;
font-weight: 500;
border: none;
background: transparent;
border-radius: 0;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
position: relative;
outline: none;
}
.page-tab:hover {
background: transparent;
color: #000;
}
.page-tab.active {
color: #000;
background: #f0f0f0;
font-weight: 600;
}
.page-tab.active::after {
content: '';
position: absolute;
bottom: 0;
left: 0;
right: 0;
height: 3px;
background-color: #0078d7;
}
@media (max-width: 768px) {
.page-tab {
padding: 10px 20px;
font-size: 16px;
}
.page-header {
padding: 0 10px;
}
}
#main {
padding: 0;
min-height: calc(100vh - 40px);
}
#queryPage {
padding: 0 20px 20px 20px;
}
@media (max-width: 768px) {
#queryPage {
padding: 0 10px 10px 10px;
}
}
#groupSortPage {
padding: 0 20px 20px 20px;
min-height: calc(100vh - 40px);
box-sizing: border-box;
}
@media (max-width: 768px) {
#groupSortPage {
padding: 0 10px 10px 10px;
}
#groupSortTopBar {
flex-direction: column;
align-items: flex-start;
gap: 12px;
}
#groupSortTopBar button {
align-self: flex-end;
}
}
#groupSortLegend {
font-size: 14px;
display: flex;
flex-wrap: wrap;
align-items: center;
gap: 16px;
}
#groupSortLegend .legend-item {
display: inline-flex;
align-items: center;
gap: 6px;
padding: 4px 8px;
border-radius: 4px;
background: #f9f9f9;
}
#groupSortLegend .legend-color {
display: inline-block;
width: 16px;
height: 16px;
vertical-align: middle;
margin-right: 4px;
border: 1px solid #ccc;
}
#groupSortGenerateBtn {
position: fixed;
bottom: 70px;
right: 20px;
z-index: 99;
}
</style>
</head><body>
<div id="passwordArea">
<h1 style="margin-bottom:20px;font-size:24px;">ğŸ“– ä¹¦å¸æŸ¥è¯¢å·¥å…·</h1>
<h2>è¯·è¾“å…¥å¯†ç </h2>
<div id="pwdInputWrapper">
<input type="password" id="pwdInput" placeholder="è¯·è¾“å…¥å¯†ç ">
</div>
<br>
<button id="pwdConfirm" onclick="checkPwd()">ç¡®å®š</button>
<p id="pwdMsg" style="color:red;"></p>
</div><div id="main">
<div id="queryPage" class="page-container active">
<div class="page-header">
<div class="page-tabs">
<button class="page-tab active" onclick="switchPage('query')">æŸ¥è¯¢é¡µ</button>
<button class="page-tab" onclick="switchPage('groupSort')">åˆ†ç»„æ’åºè¡¨</button>
</div>
</div>
<div style="text-align:center; margin-bottom:10px;">
<button id="refreshBtn" onclick="loadCacheTable()">åŠ è½½ç¼“å­˜è¡¨æ ¼</button>
<button id="loadCacheBtn" onclick="clearInputData()">æ¸…ç©ºè¡¨æ ¼å†…å®¹</button>
<div id="status" class="statusText">
<span id="statusText">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åŠ è½½ç¼“å­˜è¡¨æ ¼æˆ–æ‰‹åŠ¨å¤åˆ¶<a href="https://docs.qq.com/sheet/DUHFGbE54d0JDcWFT?tab=1i6wf3" target="_blank">ä½™é¢æ±‡æ€»è¡¨</a>ç²˜è´´è‡³ä¸‹æ–¹ï¼ˆæ³¨æ„ä¸è¦ç²˜è´´ä¸ºçº¯æ–‡æœ¬ï¼‰</span>
<span id="statusMsg" style="margin-left:8px;color:red"></span>
</div>
</div><div id="inputWrapper">
<div id="placeholderText">è‡ªåŠ¨è·å–æˆ–æ‰‹åŠ¨ç²˜è´´è¡¨æ ¼å†…å®¹</div>
<div id="inputData" contenteditable="true"></div>
</div><div style="margin:10px 0; text-align:center;">
<input type="number" id="numInput" placeholder="è¾“å…¥æ‰€éœ€ä¹¦å¸">
<button onclick="search()">æŸ¥è¯¢</button>
<button id="undoBtn" onclick="undoDelete()"> æ’¤é”€åˆ é™¤</button>
</div>
<div id="captureArea"><div id="calcSection" style="display:none; flex-direction:column; align-items:center; margin-bottom:12px; font-size:16px; line-height:1.4; gap:4px;">
<div id="needCoin" style="display:none; font-size:18px; font-weight:600; margin-bottom:0;"> æ‰€éœ€ä¹¦å¸ï¼š<span id="inputCoin" style="display:inline-block; min-width:40px">0</span></div><div id="result" style="margin:0; padding:0;"></div><div id="dealAndTransfer" style="display:flex;font-size:16px; align-items:center;gap:20px;font-weight:600;">
<div>æˆäº¤ä»·ï¼š<span id="dealPrice">0.00</span></div>
<div>åˆ°æ‰‹ä»·ï¼š<span id="afterDealPrice">0.00</span></div>
<div>æœ¬å•èµšå–ï¼š<span id="profitPrice">0.00</span></div>
<div>éœ€è½¬è´¦ï¼š<span id="transferResult">0.00</span></div>
</div><div id="feeOptions" style="display:flex;font-size:14px;  justify-content:center; gap:25px; font-weight:normal;">
<label style="display:flex; align-items:center; gap:6px;">
<input type="checkbox" id="platformFee"> 6â€°äº¤æ˜“å¹³å°æœåŠ¡è´¹
</label>
<label style="display:flex; align-items:center; gap:6px;">
<input type="checkbox" id="personalFee"> 20%ä¸ªäººæ‰‹ç»­è´¹
</label>
</div>
</div>
</div>
<button id="generateImgBtn" style="display:none;">ç”ŸæˆæŸ¥è¯¢ç»“æœå›¾</button>
</div>
<div id="groupSortPage" class="page-container">
<div class="page-header">
<div class="page-tabs">
<button class="page-tab" onclick="switchPage('query')">æŸ¥è¯¢é¡µ</button>
<button class="page-tab active" onclick="switchPage('groupSort')">åˆ†ç»„æ’åºè¡¨</button>
</div>
</div>
<div id="groupSortTopBar" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding:12px 0;border-bottom:1px solid #e0e0e0;">
<div id="groupSortLegend"></div>
<button id="groupSortGenerateBtn" style="display:none;padding:8px 20px;font-size:14px;">ç”Ÿæˆå›¾ç‰‡</button>
</div>
<div id="groupSortTableWrapper">
<table id="groupSortTable"></table>
</div>
<div id="groupSortCaptureArea" style="display:none;"></div>
</div>
<div id="imgPopup" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:1000;flex-direction:column;">
<div style="background:#fff;padding:12px;border-radius:8px;display:flex;flex-direction:column;align-items:center;max-width:90%;max-height:90%;overflow:auto;">
<img id="generatedImg" src="" alt="æŸ¥è¯¢ç»“æœ" style="max-width:100%;height:auto;margin-bottom:12px;border:1px solid #ccc;">
<div id="imgTip" style="margin-bottom:12px;font-size:14px;color:#555;text-align:center;">å¤åˆ¶å›¾ç‰‡ / ä¿å­˜å›¾ç‰‡</div>
<div style="display:flex;gap:12px;">
<button id="copyImgBtn" class="imgBtn">å¤åˆ¶å›¾ç‰‡</button>
<button id="saveImgBtn" class="imgBtn">ä¿å­˜å›¾ç‰‡</button>
</div>
</div>
</div><script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>            function sha256(str) {const buffer = new TextEncoder().encode(str);return crypto.subtle.digest('SHA-256', buffer).then(hash => {const hexCodes = [];const view = new DataView(hash);for (let i = 0; i < view.byteLength; i += 4) {const value = view.getUint32(i);const stringValue = value.toString(16);const padding = '00000000';const paddedValue = (padding + stringValue).slice(-padding.length);hexCodes.push(paddedValue);}return hexCodes.join('');});}            const PASSWORD = "8ad1cdff8e94be94d940280fa25ab89403d6d15f8dc37badda286b11d840d834";
const STORAGE_KEY = "wenxindushu_pwd_ok";
const CACHE_KEY = "wenxindushu_table_cache";window.upperPool = window.upperPool || [];
window.lowerPool = window.lowerPool || [];
window.expiredPool = window.expiredPool || [];
window.latestResult = window.latestResult || [];
window.deletedStack = window.deletedStack || [];
window.supplementStack = window.supplementStack || [];
window.origPositionMap = window.origPositionMap || new Map();
window.overlayButtons = window.overlayButtons || [];
window.deletedIds = window.deletedIds || new Set();
window.initialLatestLength = window.initialLatestLength || null;window.normalGroup = window.normalGroup || [];
window.slowGroup = window.slowGroup || [];
window.zhanGroup = window.zhanGroup || [];
window.lowGroup = window.lowGroup || [];
function showPopup(msg, duration = 2000) {
const popup = document.createElement("div");
popup.innerText = msg;
popup.style.position = "fixed";
popup.style.top = "50%";
popup.style.left = "50%";
popup.style.transform = "translate(-50%,-50%)";
popup.style.background = "rgba(0,0,0,0.8)";
popup.style.color = "#fff";
popup.style.padding = "12px 20px";
popup.style.borderRadius = "6px";
popup.style.fontSize = "14px";
popup.style.zIndex = "10000";
popup.style.textAlign = "center";
document.body.appendChild(popup);
setTimeout(() => {
document.body.removeChild(popup)
}, duration);
}
async function checkPwd() {
const val = document.getElementById("pwdInput").value.trim();
const hashedVal = await sha256(val);
if (hashedVal === PASSWORD) {
localStorage.setItem(STORAGE_KEY, "true");
showMain();
} else {
    document.getElementById("pwdMsg").innerText = "å¯†ç é”™è¯¯";
}
}function showMain() {
document.getElementById("passwordArea").style.display = "none";
document.getElementById("main").style.display = "block";
document.getElementById("statusMsg").innerText = "";
const cached = localStorage.getItem(CACHE_KEY);
if (cached) {
const container = document.getElementById("inputData");
container.innerHTML = cached;
document.getElementById("placeholderText").style.display = 'none';
}
}
window.onload = function() {
if (localStorage.getItem(STORAGE_KEY) === "true") showMain();
}
const inputData = document.getElementById('inputData');
const placeholderText = document.getElementById('placeholderText');
inputData.addEventListener('focus', () => {
placeholderText.style.display = 'none';
});
inputData.addEventListener('blur', () => {
if (inputData.innerText.trim() === '') placeholderText.style.display = 'block';
});
inputData.addEventListener('input', () => {
if (inputData.innerText.trim() === '') placeholderText.style.display = 'block';
else placeholderText.style.display = 'none';
try {
localStorage.setItem(CACHE_KEY, inputData.innerHTML);
} catch (e) {
console.warn('ç¼“å­˜ä¿å­˜å¤±è´¥', e);
}
});function formatUpdateTime(submitStr) {
if (!submitStr) return '';
const submitDate = new Date(String(submitStr).replace(/-/g, '/'));
if (isNaN(submitDate)) return submitStr;
const submitDay = new Date(submitDate.getFullYear(), submitDate.getMonth(), submitDate.getDate());
const now = new Date();
const nowDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
const diff = Math.floor((nowDay - submitDay) / (1000 * 60 * 60 * 24));
if (diff === 0) return 'ä»Šæ—¥å†…';
return diff + 'å¤©å‰';
}function parseTimeToTs(str) {
if (!str) return null;
const s = String(str).replace(/\./g, '/').replace(/å¹´|æœˆ/g, '/').replace(/æ—¥/g, '').trim();
const d = new Date(s);
if (!isNaN(d)) return d.getTime();
return null;
}function loadCacheTable() {
const container = document.getElementById("inputData");
const cache = localStorage.getItem(CACHE_KEY);
if (cache) {
container.innerHTML = cache;
placeholderText.style.display = 'none';
if (document.getElementById("groupSortPage").classList.contains("active")) {
setTimeout(() => updateGroupSortTable(), 100);
}
} else {
showPopup("æ— ç¼“å­˜è¡¨æ ¼å¯ç”¨ï¼Œè¯·æ‰‹åŠ¨ç²˜è´´è¡¨æ ¼å†…å®¹");
}
}function clearInputData() {
const container = document.getElementById("inputData");
container.innerHTML = "";
placeholderText.style.display = 'block';
document.getElementById("statusMsg").innerText = "";
if (document.getElementById("groupSortPage").classList.contains("active")) {
const cache = localStorage.getItem(CACHE_KEY);
if (cache) {
container.innerHTML = cache;
placeholderText.style.display = 'none';
setTimeout(() => updateGroupSortTable(), 100);
} else {
updateGroupSortTable();
}
}
}
function classify(item) {
if (item.æ˜¯å¦æš‚åœ) return 'å¼ƒç½®ç»„';
if (item.æ˜¯å¦è¿‡æœŸ) return 'è¿‡æœŸç»„';
if (item.ä¿¡ç”¨åˆ†é€»è¾‘ < 6) return 'å¼ƒç½®ç»„';
if (item.ä¿¡ç”¨åˆ†é€»è¾‘ < 8) return 'ä½åˆ†ç»„';
if (item.ä¿¡ç”¨åˆ†é€»è¾‘ >= 8) {
if (item.æ˜¯å¦æ”’) return 'æ”’å¸ç»„';
if (item.æ˜¯å¦ä¸æ¥æ€¥å•) return 'ä½é€Ÿç»„';
return 'æ­£å¸¸ç»„';
}
}function search() {
const container = document.getElementById("inputData");
const inputVal = parseFloat(document.getElementById("numInput").value);
if (!container.querySelector('table')) {
showPopup("è¯·å…ˆåŠ è½½ç¼“å­˜è¡¨æ ¼æˆ–æ‰‹åŠ¨ç²˜è´´æ•°æ®");
document.getElementById("result").innerHTML = "";
return;
}
if (isNaN(inputVal)) {
showPopup("è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—");
return;
}
window.deletedIds = new Set();
window.deletedStack = [];
window.supplementStack = [];
window.initialLatestLength = null;window.currentNum = inputVal;
const num = window.currentNum;const table = container.querySelector('table');
let submitColIdx = 8;
try {
let headerRow = table.querySelector('thead tr');
if (!headerRow) headerRow = table.rows[0];
if (headerRow) {
const heads = Array.from(headerRow.cells || []).map(h => h.innerText.trim());
for (let i = 0; i < heads.length; i++) {
if (/æäº¤æ—¶é—´|æ›´æ–°æ—¶é—´|æäº¤æ—¥æœŸ/.test(heads[i])) {
if (i >= 2 && i <= 7) continue;
submitColIdx = i;
break;
}
}
}
} catch (e) {  }const rows = Array.from(table.rows).slice(1);function parseAccounts(row) {
const cells = row.cells;
if (!cells || cells.length === 0) return [];
if (cells.length < 9) {
console.warn('è¡¨æ ¼åˆ—æ•°ä¸è¶³ï¼ŒæœŸæœ›è‡³å°‘9åˆ—ï¼ˆä¿¡ç”¨åˆ†ã€ç¾¤æ˜µç§°ã€è´¦å·1-6ã€æäº¤æ—¶é—´ï¼‰ï¼Œå®é™…:', cells.length);
}
const rawCredit = (cells[0] && cells[0].innerText) ? cells[0].innerText.trim() : '';
const creditForLogic = parseFloat(rawCredit) || 10;
const name = (cells[1] && cells[1].innerText) ? cells[1].innerText.trim() : '';
const accounts = [
cells[2] ? cells[2].innerText.trim() : '',
cells[3] ? cells[3].innerText.trim() : '',
cells[4] ? cells[4].innerText.trim() : '',
cells[5] ? cells[5].innerText.trim() : '',
cells[6] ? cells[6].innerText.trim() : '',
cells[7] ? cells[7].innerText.trim() : ''
];
const submit = (cells[submitColIdx] && cells[submitColIdx].innerText) ? cells[submitColIdx].innerText.trim() : '';
const updateStr = submit;const list = [];
accounts.forEach((text, k) => {
if (!text) {
if (k >= 4) console.log(`è´¦å·${k+1}ä¸ºç©ºï¼Œè·³è¿‡`);
return;
}
const valMatch = text.replace(/,/g, '').match(/\d+(\.\d+)?/);
const val = valMatch ? parseFloat(valMatch[0]) : null;
if (val === null) {
if (k >= 4) console.log(`è´¦å·${k+1}æ— æ³•è§£ææ•°å€¼ï¼Œæ–‡æœ¬:`, text);
}
if (val !== null) {
const updateTs = parseTimeToTs(updateStr) || parseTimeToTs(submit) || null;
list.push({
ç¾¤æ˜µç§°: name,
è´¦å·: `è´¦å·${k+1}`,
ä¹¦å¸: text,
æäº¤æ—¶é—´: formatUpdateTime(submit),
æ›´æ–°æ—¶é—´: formatUpdateTime(updateStr),
æ›´æ–°æ—¶é—´_ts: updateTs,
æ˜¯å¦è¿‡æœŸ: /è¿‡æœŸ|åˆ°æœŸ/.test(text),
æ˜¯å¦æ”’: /æ”’/.test(text),
æ˜¯å¦æš‚åœ: /æš‚åœæ¥å•|é¢„å®š|é¢„è®¢/.test(text),
æ˜¯å¦ä¸æ¥æ€¥å•: /ä¸æ¥æ€¥å•/.test(text),
æ•°å€¼: val,
ä¿¡ç”¨åˆ†: rawCredit === "" ? 10 : (parseFloat(rawCredit) || 10),
ä¿¡ç”¨åˆ†é€»è¾‘: creditForLogic,
åŸå§‹æ—¶é—´: submit,
æäº¤æ—¶é—´åŸå§‹: submit
});
}
});
return list;
}
let expiredGroup = [],
normalGroup = [],
slowGroup = [],
zhanGroup = [],
lowGroup = [],
discardGroup = [];
rows.forEach(row => {
parseAccounts(row).forEach(item => {
const g = classify(item);
switch (g) {
case 'è¿‡æœŸç»„':
expiredGroup.push(item);
break;
case 'æ­£å¸¸ç»„':
normalGroup.push(item);
break;
case 'ä½é€Ÿç»„':
slowGroup.push(item);
break;
case 'æ”’å¸ç»„':
zhanGroup.push(item);
break;
case 'ä½åˆ†ç»„':
lowGroup.push(item);
break;
case 'å¼ƒç½®ç»„':
discardGroup.push(item);
break;
}
});
});
window.normalGroup = normalGroup;
window.slowGroup = slowGroup;
window.zhanGroup = zhanGroup;
window.lowGroup = lowGroup;
window.upperPool = [];
window.lowerPool = [];
window.expiredPool = [];
window.latestResult = [];
window.origPositionMap = new Map();
window.overlayButtons = [];
const expiredAll = Array.isArray(window.expiredGroup) ? window.expiredGroup
: (typeof expiredGroup !== 'undefined' && Array.isArray(expiredGroup) ? expiredGroup : []);
const expiredFiltered = (expiredAll || []).filter(r => typeof r.æ•°å€¼ === 'number' && r.æ•°å€¼ >= num - 10);
expiredFiltered.sort((a, b) => {
if (a.æ•°å€¼ !== b.æ•°å€¼) return a.æ•°å€¼ - b.æ•°å€¼;
if (a.ä¿¡ç”¨åˆ† !== b.ä¿¡ç”¨åˆ†) return (b.ä¿¡ç”¨åˆ† || 0) - (a.ä¿¡ç”¨åˆ† || 0);
return (b.æ›´æ–°æ—¶é—´_ts || 0) - (a.æ›´æ–°æ—¶é—´_ts || 0);
});
window.expiredPool = expiredFiltered.slice();
const allCandidates = [...(window.normalGroup || []), ...(window.slowGroup || []), ...(window.zhanGroup || []), ...(window.lowGroup || [])];
const upperCandidates = allCandidates.filter(r => typeof r.æ•°å€¼ === 'number' && r.æ•°å€¼ >= num - 10 && r.æ•°å€¼ < num);
const upperGroupOrder = ['ä½åˆ†ç»„', 'æ”’å¸ç»„', 'ä½é€Ÿç»„', 'æ­£å¸¸ç»„'];
upperCandidates.sort((a, b) => {
const ga = upperGroupOrder.indexOf(classify(a)), gb = upperGroupOrder.indexOf(classify(b));
if (ga !== gb) return ga - gb;
if (a.æ•°å€¼ !== b.æ•°å€¼) return a.æ•°å€¼ - b.æ•°å€¼;
if (a.ä¿¡ç”¨åˆ† !== b.ä¿¡ç”¨åˆ†) return (b.ä¿¡ç”¨åˆ† || 0) - (a.ä¿¡ç”¨åˆ† || 0);
return (b.æ›´æ–°æ—¶é—´_ts || 0) - (a.æ›´æ–°æ—¶é—´_ts || 0);
});
const expiredUpper = window.expiredPool.filter(r => typeof r.æ•°å€¼ === 'number' && r.æ•°å€¼ < num);
const fullUpperPool = [...upperCandidates, ...expiredUpper];
fullUpperPool.forEach(r => { if (!r._key) r._key = `${r.ç¾¤æ˜µç§°}||${r.è´¦å·}||${r.ä¹¦å¸}||${r.åŸå§‹æ—¶é—´}`; });
window.upperPool = fullUpperPool.slice();
const upperForDisplay = fullUpperPool.slice(Math.max(0, fullUpperPool.length - 3));
const lowerCandidatesAll = allCandidates.filter(r => typeof r.æ•°å€¼ === 'number' && r.æ•°å€¼ >= num);
lowerCandidatesAll.forEach(r => { if (!r._key) r._key = `${r.ç¾¤æ˜µç§°}||${r.è´¦å·}||${r.ä¹¦å¸}||${r.åŸå§‹æ—¶é—´}`; });
const expiredLower = window.expiredPool.filter(r => typeof r.æ•°å€¼ === 'number' && r.æ•°å€¼ >= num);
expiredLower.forEach(r => { if (!r._key) r._key = `${r.ç¾¤æ˜µç§°}||${r.è´¦å·}||${r.ä¹¦å¸}||${r.åŸå§‹æ—¶é—´}`; });
const step = 10;
const maxSegments = 200;
const lowerPoolFull = [];
const lowerSeen = new Set();
for (const r of expiredLower) {
if (!lowerSeen.has(r._key)) {
lowerPoolFull.push(r);
lowerSeen.add(r._key);
}
}const globalMax = lowerCandidatesAll.length > 0 ? Math.max(...lowerCandidatesAll.map(r => r.æ•°å€¼)) : num;
for (let seg = 0; seg < maxSegments; seg++) {
const start = num + seg * step;
const end = start + step;
const segItems = lowerCandidatesAll.filter(r => r.æ•°å€¼ >= start && r.æ•°å€¼ < end && !lowerSeen.has(r._key));
if (segItems.length > 0) {
const order = ['æ­£å¸¸ç»„', 'ä½é€Ÿç»„', 'æ”’å¸ç»„', 'ä½åˆ†ç»„'];
segItems.sort((a, b) => {
const ga = order.indexOf(classify(a)), gb = order.indexOf(classify(b));
if (ga !== gb) return ga - gb;
if (a.æ•°å€¼ !== b.æ•°å€¼) return a.æ•°å€¼ - b.æ•°å€¼;
if (a.ä¿¡ç”¨åˆ† !== b.ä¿¡ç”¨åˆ†) return (b.ä¿¡ç”¨åˆ† || 0) - (a.ä¿¡ç”¨åˆ† || 0);
return (b.æ›´æ–°æ—¶é—´_ts || 0) - (a.æ›´æ–°æ—¶é—´_ts || 0);
});
for (const it of segItems) {
lowerPoolFull.push(it);
lowerSeen.add(it._key);
}
}
if (end >= globalMax) break;
}
if (lowerPoolFull.length < 4 && lowerCandidatesAll.length > lowerPoolFull.length) {
const remaining = lowerCandidatesAll.filter(r => !lowerSeen.has(r._key));
const order = ['æ­£å¸¸ç»„', 'ä½é€Ÿç»„', 'æ”’å¸ç»„', 'ä½åˆ†ç»„'];
remaining.sort((a, b) => {
const ga = order.indexOf(classify(a)), gb = order.indexOf(classify(b));
if (ga !== gb) return ga - gb;
if (a.æ•°å€¼ !== b.æ•°å€¼) return a.æ•°å€¼ - b.æ•°å€¼;
if (a.ä¿¡ç”¨åˆ† !== b.ä¿¡ç”¨åˆ†) return (b.ä¿¡ç”¨åˆ† || 0) - (a.ä¿¡ç”¨åˆ† || 0);
return (b.æ›´æ–°æ—¶é—´_ts || 0) - (a.æ›´æ–°æ—¶é—´_ts || 0);
});
for (const it of remaining) {
if (!lowerSeen.has(it._key)) {
lowerPoolFull.push(it);
lowerSeen.add(it._key);
if (lowerPoolFull.length >= 40) break;
}
}
}window.lowerPool = lowerPoolFull.slice();
const lowerForDisplay = lowerPoolFull.slice(0, 4);
const mergedDisplay = [...upperForDisplay, ...lowerForDisplay].slice(0, 7);
window.latestResult = mergedDisplay.slice();
window.latestResult.forEach((r, idx) => {
if (!r._key) r._key = `${r.ç¾¤æ˜µç§°}||${r.è´¦å·}||${r.ä¹¦å¸}||${r.åŸå§‹æ—¶é—´}`;
r._origPos = idx;
window.origPositionMap.set(r._key, idx);
});window.initialLatestLength = window.latestResult.length;updateHighlight();
renderTableAll();
if (typeof renderCalcSection === 'function') renderCalcSection(num);
}
function getUpperSupplement(num) {
if (Array.isArray(window.upperPool)) {
for (let i = window.upperPool.length - 1; i >= 0; i--) {
const r = window.upperPool[i];
const k = r._key;
const isShown = window.latestResult && window.latestResult.some(x => x._key === k);
const isDeleted = window.deletedIds && window.deletedIds.has(k);
const isSupped = window.supplementStack && window.supplementStack.some(x => x._key === k);
if (!isShown && !isDeleted && !isSupped && r.æ•°å€¼ >= num - 10 && r.æ•°å€¼ < num) return r;
}
}
const all = [
...(window.normalGroup || []),
...(window.slowGroup || []),
...(window.zhanGroup || []),
...(window.lowGroup || []),
...(window.expiredPool || [])
];
all.sort((a, b) => a.æ•°å€¼ - b.æ•°å€¼);
for (let i = all.length - 1; i >= 0; i--) {
const r = all[i];
const k = r._key || `${r.ç¾¤æ˜µç§°}||${r.è´¦å·}||${r.ä¹¦å¸}||${r.åŸå§‹æ—¶é—´}`;
if (!r._key) r._key = k;
const isShown = window.latestResult && window.latestResult.some(x => x._key === k);
const isDeleted = window.deletedIds && window.deletedIds.has(k);
const isSupped = window.supplementStack && window.supplementStack.some(x => x._key === k);
if (!isShown && !isDeleted && !isSupped && typeof r.æ•°å€¼ === 'number' && r.æ•°å€¼ >= num - 10 && r.æ•°å€¼ < num) return r;
}
return null;
}function getLowerSupplement(num) {
if (Array.isArray(window.lowerPool)) {
for (let i = 0; i < window.lowerPool.length; i++) {
const r = window.lowerPool[i];
const k = r._key;
const isShown = window.latestResult && window.latestResult.some(x => x._key === k);
const isDeleted = window.deletedIds && window.deletedIds.has(k);
const isSupped = window.supplementStack && window.supplementStack.some(x => x._key === k);
if (!isShown && !isDeleted && !isSupped && r.æ•°å€¼ >= num) return r;
}
}
const all = [
...(window.normalGroup || []),
...(window.slowGroup || []),
...(window.zhanGroup || []),
...(window.lowGroup || []),
...(window.expiredPool || [])
].filter(r => typeof r.æ•°å€¼ === 'number' && r.æ•°å€¼ >= num);const order = ['æ­£å¸¸ç»„', 'ä½é€Ÿç»„', 'æ”’å¸ç»„', 'ä½åˆ†ç»„'];
all.sort((a, b) => {
const ga = order.indexOf(classify(a)), gb = order.indexOf(classify(b));
if (ga !== gb) return ga - gb;
if (a.æ•°å€¼ !== b.æ•°å€¼) return a.æ•°å€¼ - b.æ•°å€¼;
if (a.ä¿¡ç”¨åˆ† !== b.ä¿¡ç”¨åˆ†) return (b.ä¿¡ç”¨åˆ† || 0) - (a.ä¿¡ç”¨åˆ† || 0);
return (b.æ›´æ–°æ—¶é—´_ts || 0) - (a.æ›´æ–°æ—¶é—´_ts || 0);
});for (const r of all) {
const k = r._key || `${r.ç¾¤æ˜µç§°}||${r.è´¦å·}||${r.ä¹¦å¸}||${r.åŸå§‹æ—¶é—´}`;
if (!r._key) r._key = k;
const isShown = window.latestResult && window.latestResult.some(x => x._key === k);
const isDeleted = window.deletedIds && window.deletedIds.has(k);
const isSupped = window.supplementStack && window.supplementStack.some(x => x._key === k);
if (!isShown && !isDeleted && !isSupped) return r;
}
return null;
}
function deleteRowByKey(key) {
if (!window.latestResult) return;
const idx = window.latestResult.findIndex(r => r._key === key);
let deleted = null;
let deletedFromExpired = false;
let deletedExpiredIdx = -1;if (idx !== -1) {
deleted = window.latestResult.splice(idx, 1)[0];
} else if (Array.isArray(window.expiredPool)) {
const idxE = window.expiredPool.findIndex(r => r._key === key);
if (idxE !== -1) {
deleted = window.expiredPool.splice(idxE, 1)[0];
deletedFromExpired = true;
deletedExpiredIdx = idxE;
}
}
if (!deleted) return;const delKey = deleted._key || `${deleted.ç¾¤æ˜µç§°}||${deleted.è´¦å·}||${deleted.ä¹¦å¸}||${deleted.åŸå§‹æ—¶é—´}`;
if (!window.deletedIds) window.deletedIds = new Set();
window.deletedIds.add(delKey);const record = {
deleted: deleted,
supplement: null,
deletedIndex: idx,
deletedFromExpired,
deletedExpiredIdx
};
const num = window.currentNum;
let newItem = null;
if (typeof deleted.æ•°å€¼ === 'number' && deleted.æ•°å€¼ < num) {
if (window.initialLatestLength === null || window.latestResult.length < window.initialLatestLength) {
newItem = getUpperSupplement(num);
if (newItem) {
if (!newItem._key) newItem._key = `${newItem.ç¾¤æ˜µç§°}||${newItem.è´¦å·}||${newItem.ä¹¦å¸}||${newItem.åŸå§‹æ—¶é—´}`;
const insertIndex = 0;
window.latestResult.splice(insertIndex, 0, newItem);
record.supplement = newItem;
window.supplementStack = window.supplementStack || [];
window.supplementStack.push(newItem);
}
}
} else {
if (window.initialLatestLength === null || window.latestResult.length < window.initialLatestLength) {
newItem = getLowerSupplement(num);
if (newItem) {
if (!newItem._key) newItem._key = `${newItem.ç¾¤æ˜µç§°}||${newItem.è´¦å·}||${newItem.ä¹¦å¸}||${newItem.åŸå§‹æ—¶é—´}`;
window.latestResult.push(newItem);
record.supplement = newItem;
window.supplementStack = window.supplementStack || [];
window.supplementStack.push(newItem);
}
}
}record.deleted._key = record.deleted._key || delKey;
record.deleted._origPos = (record.deleted._origPos !== undefined) ? record.deleted._origPos : record.deletedIndex;
window.deletedStack = window.deletedStack || [];
window.deletedStack.push(record);updateHighlight();
renderTableAll();
}
function undoDelete() {
if (!window.deletedStack || window.deletedStack.length === 0) return;
const record = window.deletedStack.pop();
const toRestore = record.deleted;
const sup = record.supplement;
if (sup) {
const supKey = sup._key;
const supIdx = window.latestResult.findIndex(x => x._key === supKey);
if (supIdx !== -1) window.latestResult.splice(supIdx, 1);
window.supplementStack = (window.supplementStack || []).filter(x => x._key !== supKey);
}const delKey = toRestore._key || `${toRestore.ç¾¤æ˜µç§°}||${toRestore.è´¦å·}||${toRestore.ä¹¦å¸}||${toRestore.åŸå§‹æ—¶é—´}`;
if (window.deletedIds && window.deletedIds.delete) window.deletedIds.delete(delKey);
const origPos = (toRestore._origPos !== undefined) ? toRestore._origPos : window.latestResult.length;
const insertPos = Math.min(Math.max(0, origPos), window.latestResult.length);
const existingIdx = window.latestResult.findIndex(x => x._key === toRestore._key);
if (existingIdx !== -1) window.latestResult.splice(existingIdx, 1);
window.latestResult.splice(insertPos, 0, toRestore);updateHighlight();
renderTableAll();
}
function updateHighlight() {
const num = window.currentNum;
const shown = Array.isArray(window.latestResult) ? window.latestResult : [];if (!shown || shown.length === 0) {
window.highlightValue = null;
window.highlightKey = null;
window.highlightGroup = null;
return;
}
const firstLowerExpired = shown.find(r => typeof r.æ•°å€¼ === 'number' && r.æ•°å€¼ >= num && r.æ˜¯å¦è¿‡æœŸ);
if (firstLowerExpired) {
window.highlightValue = firstLowerExpired.æ•°å€¼;
window.highlightKey = firstLowerExpired._key;
window.highlightGroup = classify(firstLowerExpired);
return;
}
for (let i = shown.length - 1; i >= 0; i--) {
const r = shown[i];
if (typeof r.æ•°å€¼ === 'number' && r.æ•°å€¼ < num && r.æ•°å€¼ >= num - 2 && r.æ˜¯å¦è¿‡æœŸ) {
window.highlightValue = r.æ•°å€¼;
window.highlightKey = r._key;
window.highlightGroup = classify(r);
return;
}
}
const firstLowerNonExpired = shown.find(r => typeof r.æ•°å€¼ === 'number' && r.æ•°å€¼ >= num && !r.æ˜¯å¦è¿‡æœŸ);
if (firstLowerNonExpired) {
window.highlightValue = firstLowerNonExpired.æ•°å€¼;
window.highlightKey = firstLowerNonExpired._key;
window.highlightGroup = classify(firstLowerNonExpired);
return;
}
for (let i = shown.length - 1; i >= 0; i--) {
const r = shown[i];
if (typeof r.æ•°å€¼ === 'number' && r.æ•°å€¼ < num && !r.æ˜¯å¦è¿‡æœŸ) {
window.highlightValue = r.æ•°å€¼;
window.highlightKey = r._key;
window.highlightGroup = classify(r);
return;
}
}
const fallback = shown[0];
window.highlightValue = fallback ? fallback.æ•°å€¼ : null;
window.highlightKey = fallback ? fallback._key : null;
window.highlightGroup = fallback ? classify(fallback) : null;
}
function renderTableAll() {
const resultDiv = document.getElementById("result");
if (!resultDiv) return;
if (!window.overlayButtons) window.overlayButtons = [];
window.overlayButtons.forEach(b => b.remove());
window.overlayButtons = [];const num = window.currentNum;
let html = "";
const allShown = Array.isArray(window.latestResult) ? window.latestResult : [];
if (allShown.length > 0) {
html += "<table style='table-layout:fixed;width:100%;border-collapse:collapse;'><thead><tr>";
html += "<th style='width:20%; text-align:center;'>ç¾¤æ˜µç§°</th>";
html += "<th style='width:15%; text-align:center;'>è´¦å·</th>";
html += "<th style='width:30%; text-align:center;'>ä¹¦å¸</th>";
html += "<th style='width:15%; text-align:center;'>æ›´æ–°æ—¶é—´</th>";
html += "<th style='width:10%; text-align:center;'>ä¿¡ç”¨åˆ†</th>";
html += "<th style='width:10%; text-align:center;'>åˆ é™¤</th></tr></thead><tbody>";
allShown.forEach(r => {
let style = "";
if (r.æ˜¯å¦è¿‡æœŸ) style += "color:#ff0000;font-weight:bold;";const group = classify(r);
switch (group) {
case 'æ­£å¸¸ç»„': style += "color:#333;font-weight:bold;"; break;
case 'ä½é€Ÿç»„': style += "color:#336699;"; break;
case 'æ”’å¸ç»„': style += "color:#555;"; break;
case 'ä½åˆ†ç»„': style += "color:#aaa;"; break;
}const isDeletedMarked = window.deletedIds && window.deletedIds.has(r._key);
const isHighlight = (window.highlightKey && r._key === window.highlightKey);
if (isHighlight) style += "background:yellow;";const delCell = `<div style="text-align:center;">
<svg onclick="deleteRowByKey('${r._key}')" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#888888" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" style="cursor:pointer;">
<path d="M7,3 a1.2,1.2 0 0 1 1.2,-1.2 h7.6 a1.2,1.2 0 0 1 1.2,1.2 v2 h-10 z" fill="none"/>
<line x1="2.5" y1="5" x2="21.5" y2="5"/>
<path d="M6,5 v14 a1.2,1.2 0 0 0 1.2,1.2 h9.6 a1.2,1.2 0 0 0 1.2,-1.2 v-14" fill="none"/>
<line x1="9" y1="7" x2="9" y2="17"/>
<line x1="12" y1="7" x2="12" y2="17"/>
<line x1="15" y1="7" x2="15" y2="17"/></svg></div>`;html += `<tr data-key="${r._key}" class="${isHighlight? 'highlight-row':''} ${isDeletedMarked? 'deleted-mark':''}">
<td style="text-align:center;">${r.ç¾¤æ˜µç§°}</td>
<td style="text-align:center;">${r.è´¦å·}</td>
<td style="text-align:center;${style}">${r.ä¹¦å¸}</td>
<td style="text-align:center;">${r.æ›´æ–°æ—¶é—´}</td>
<td style="text-align:center;">${r.ä¿¡ç”¨åˆ†}</td>
<td style="text-align:center;">${delCell}</td>
</tr>`;
});
html += "</tbody></table>";
} else {
html = "<div style='color:#666;padding:8px;text-align:center;'>æ— å¯æ˜¾ç¤ºæ¡ç›®</div>";
}resultDiv.innerHTML = html;const actionButtonsEl = document.getElementById("actionButtons");
if (actionButtonsEl) actionButtonsEl.style.display = window.latestResult && window.latestResult.length ? "flex" : "none";
}
const EXIST_ID = "dynamic-table-style";
let styleEl = document.getElementById(EXIST_ID);
if (!styleEl) {
styleEl = document.createElement("style");
styleEl.id = EXIST_ID;
document.head.appendChild(styleEl);
}
styleEl.innerHTML = `    #result table { table-layout: fixed; }
#result table tr { height: 30px; }
#result table td {
height: 30px;
line-height: 30px;
overflow: hidden;
white-space: nowrap;
text-overflow: ellipsis;
padding: 0 6px;
vertical-align: middle;
}
@media screen and (max-width: 768px) {
#result table tr { height: 50px; }
#result table td {
height: 50px;
line-height: normal;
white-space: normal;
padding: 6px 6px;
vertical-align: middle;
}
#result table td .multi-wrap {
display: flex;
align-items: center;
height: 100%;
}
#result table td .multi-wrap .multi-line {
display: -webkit-box;
-webkit-box-orient: vertical;
-webkit-line-clamp: 3;
overflow: hidden;
line-height: 20px;
max-height: 60px;
white-space: normal;             overflow-wrap: anywhere;
word-break: break-word;
}
}
`;
function renderCalcSection(num) {
const calcSection = document.getElementById("calcSection");
const needCoin = document.getElementById("needCoin");
const dealEl = document.getElementById("dealPrice");
const afterDealEl = document.getElementById("afterDealPrice");
const profitEl = document.getElementById("profitPrice");
const transferEl = document.getElementById("transferResult");
const pf = document.getElementById("platformFee");
const per = document.getElementById("personalFee");
const generateBtn = document.getElementById("generateImgBtn");if (needCoin) {
needCoin.style.display = "block";
needCoin.innerText = `æ‰€éœ€ä¹¦å¸ï¼š${num}`;
}const calc = () => {
const dealValue = Math.round(num * 0.1 * 100) / 100;
dealEl.innerText = dealValue.toFixed(2);
const afterDealValue = pf && pf.checked ? Math.round(dealValue * (1 - 0.006) * 100) / 100 : dealValue;
afterDealEl.innerText = afterDealValue.toFixed(2);
const transferValue = per && per.checked ? Math.round(dealValue * 0.8 * 100) / 100 : afterDealValue;
transferEl.innerText = transferValue.toFixed(2);
const profitValue = per && per.checked ? Math.round((afterDealValue - transferValue) * 100) / 100 : 0;
profitEl.innerText = profitValue.toFixed(2);
};pf && pf.addEventListener('change', calc);
per && per.addEventListener('change', calc);
calc();if (calcSection) calcSection.style.display = "flex";
const actionButtonsEl = document.getElementById("actionButtons");
if (actionButtonsEl) actionButtonsEl.style.display = "flex";
calcSection.style.display = "flex";
if (generateBtn) {
generateBtn.style.display = "inline-block";
}
}
async function generateResultImage() {
const captureArea = document.getElementById("captureArea");
if (!captureArea) {
showPopup("æ— æŸ¥è¯¢ç»“æœå¯æˆªå›¾");
return;
}
const wrapper = document.createElement('div');
wrapper.style.width = '500px';
wrapper.style.padding = '12px';
wrapper.style.background = '#fff';
wrapper.style.position = 'absolute';
wrapper.style.left = '-9999px';
wrapper.style.boxSizing = 'border-box';
wrapper.style.fontFamily = 'Arial, sans-serif';
wrapper.style.fontSize = '14px';const clone = captureArea.cloneNode(true);
clone.style.width = '100%';
wrapper.appendChild(clone);
document.body.appendChild(wrapper);
const canvas = await html2canvas(wrapper, {
backgroundColor: null,
scale: 2
});
const dataUrl = canvas.toDataURL('image/png');
document.body.removeChild(wrapper);
const imgEl = document.getElementById("generatedImg");
imgEl.src = dataUrl;
imgEl.style.maxWidth = '500px';
imgEl.style.width = 'auto';
imgEl.style.height = 'auto';
imgEl.style.borderRadius = '6px';
imgEl.style.boxShadow = '0 0 8px rgba(0,0,0,0.3)';
const tipEl = document.getElementById("imgTip");
if (/Android|iPhone/i.test(navigator.userAgent)) {
tipEl.innerText = "å¤åˆ¶å¤±è´¥æ—¶å¯é•¿æŒ‰å›¾ç‰‡å¤åˆ¶æˆ–ä¿å­˜";
} else {
tipEl.innerText = "å¤åˆ¶å¤±è´¥æ—¶å¯å³é”®å•å‡»å›¾ç‰‡å¤åˆ¶æˆ–ä¿å­˜";
}
const popup = document.getElementById("imgPopup");
popup.style.display = "flex";
popup.style.position = "fixed";
popup.style.top = "0";
popup.style.left = "0";
popup.style.width = "100%";
popup.style.height = "100%";
popup.style.background = "rgba(0,0,0,0.5)";
popup.style.justifyContent = "center";
popup.style.alignItems = "center";
popup.style.padding = "20px";
popup.style.boxSizing = "border-box";
popup.style.overflow = "auto";
popup.style.zIndex = "9999";
popup.onclick = function(e) {
if (e.target === popup || e.target.classList.contains('popup-background')) {
popup.style.display = "none";
}
};
const popupContent = popup.querySelector('div');
if (popupContent) {
popupContent.onclick = function(e) {
e.stopPropagation();
};
}
}
async function copyGeneratedImg() {
const img = document.getElementById("generatedImg");
if (!img.src) return;
try {
const response = await fetch(img.src);
const blob = await response.blob();
await navigator.clipboard.write([new ClipboardItem({
"image/png": blob
})]);
showPopup("å·²å¤åˆ¶å›¾ç‰‡ï¼Œå¯ç›´æ¥ç²˜è´´åˆ°å¾®ä¿¡");
} catch (err) {
showPopup("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶å›¾ç‰‡");
console.error(err);
}
}
function saveGeneratedImg() {
const img = document.getElementById("generatedImg");
if (!img.src) return showPopup("æ— å›¾ç‰‡å¯ä¿å­˜");
const link = document.createElement("a");
link.href = img.src;
const isGroupSort = window.currentGroupSortImg === img.src;
link.download = isGroupSort ? "åˆ†ç»„æ’åºè¡¨.png" : "æŸ¥è¯¢ç»“æœ.png";
link.click();
}
document.getElementById("generateImgBtn") ?.addEventListener("click", generateResultImage);
document.getElementById("copyImgBtn") ?.addEventListener("click", copyGeneratedImg);
document.getElementById("saveImgBtn") ?.addEventListener("click", saveGeneratedImg);
function switchPage(page) {
const queryPage = document.getElementById("queryPage");
const groupSortPage = document.getElementById("groupSortPage");
const allTabs = document.querySelectorAll(".page-tab");
if (page === 'query') {
queryPage.classList.add("active");
groupSortPage.classList.remove("active");
allTabs.forEach((tab, idx) => {
if (idx === 0) tab.classList.add("active");
else tab.classList.remove("active");
});
} else {
queryPage.classList.remove("active");
groupSortPage.classList.add("active");
allTabs.forEach((tab, idx) => {
if (idx === 1) tab.classList.add("active");
else tab.classList.remove("active");
});
updateGroupSortTable();
}
}
function getGroupIndex(num) {
if (num >= 100) return 1;
if (num >= 80) return 2;
if (num >= 50) return 3;
if (num >= 30) return 4;
return 5;
}
function parseAllAccounts() {
const container = document.getElementById("inputData");
const table = container.querySelector('table');
if (!table) return [];
let submitColIdx = 8;
try {
let headerRow = table.querySelector('thead tr');
if (!headerRow) headerRow = table.rows[0];
if (headerRow) {
const heads = Array.from(headerRow.cells || []).map(h => h.innerText.trim());
for (let i = 0; i < heads.length; i++) {
if (/æäº¤æ—¶é—´|æ›´æ–°æ—¶é—´|æäº¤æ—¥æœŸ/.test(heads[i])) {
if (i >= 2 && i <= 7) continue;
submitColIdx = i;
break;
}
}
}
} catch (e) {}
const rows = Array.from(table.rows).slice(1);
const allItems = [];
rows.forEach(row => {
const cells = row.cells;
if (!cells || cells.length === 0) return;
const rawCredit = (cells[0] && cells[0].innerText) ? cells[0].innerText.trim() : '';
const creditForLogic = parseFloat(rawCredit) || 10;
const name = (cells[1] && cells[1].innerText) ? cells[1].innerText.trim() : '';
const accounts = [
cells[2] ? cells[2].innerText.trim() : '',
cells[3] ? cells[3].innerText.trim() : '',
cells[4] ? cells[4].innerText.trim() : '',
cells[5] ? cells[5].innerText.trim() : '',
cells[6] ? cells[6].innerText.trim() : '',
cells[7] ? cells[7].innerText.trim() : ''
];
const submit = (cells[submitColIdx] && cells[submitColIdx].innerText) ? cells[submitColIdx].innerText.trim() : '';
accounts.forEach((text, k) => {
if (!text) return;
const valMatch = text.replace(/,/g, '').match(/\d+(\.\d+)?/);
const val = valMatch ? parseFloat(valMatch[0]) : null;
if (val !== null) {
const updateTs = parseTimeToTs(submit) || null;
allItems.push({
ç¾¤æ˜µç§°: name,
è´¦å·: `è´¦å·${k+1}`,
ä¹¦å¸: text,
æ•°å€¼: val,
ä¿¡ç”¨åˆ†: rawCredit === "" ? 10 : (parseFloat(rawCredit) || 10),
ä¿¡ç”¨åˆ†é€»è¾‘: creditForLogic,
æ˜¯å¦è¿‡æœŸ: /è¿‡æœŸ|åˆ°æœŸ/.test(text),
æ˜¯å¦æ”’: /æ”’/.test(text),
æ˜¯å¦æš‚åœ: /æš‚åœæ¥å•|é¢„å®š|é¢„è®¢/.test(text),
æ˜¯å¦ä¸æ¥æ€¥å•: /ä¸æ¥æ€¥å•/.test(text),
æäº¤æ—¶é—´: submit,
æ›´æ–°æ—¶é—´_ts: updateTs
});
}
});
});
return allItems;
}
function updateGroupSortTable() {
const allItems = parseAllAccounts();
const groups = [[], [], [], [], [], [], []];
allItems.forEach(item => {
let groupIdx;
const isReserve = item.æ˜¯å¦æš‚åœ && (item.ä¹¦å¸.includes("é¢„å®š") || item.ä¹¦å¸.includes("é¢„è®¢"));
if (item.æ˜¯å¦æš‚åœ && !isReserve) {
groupIdx = 6;
} else {
groupIdx = getGroupIndex(item.æ•°å€¼);
}
if (groupIdx >= 0 && groupIdx < groups.length) {
groups[groupIdx].push(item);
}
});
const groupOrder = ['æ­£å¸¸ç»„', 'ä½é€Ÿç»„', 'æ”’å¸ç»„', 'ä½åˆ†ç»„', 'å¼ƒç½®ç»„'];
for (let i = 1; i <= 6; i++) {
if (groups[i].length > 0) {
groups[i].sort((a, b) => {
if (a.æ•°å€¼ !== b.æ•°å€¼) return b.æ•°å€¼ - a.æ•°å€¼;
const aIsReserve = a.æ˜¯å¦æš‚åœ && (a.ä¹¦å¸.includes("é¢„å®š") || a.ä¹¦å¸.includes("é¢„è®¢"));
const bIsReserve = b.æ˜¯å¦æš‚åœ && (b.ä¹¦å¸.includes("é¢„å®š") || b.ä¹¦å¸.includes("é¢„è®¢"));
if (aIsReserve && !bIsReserve) return 1;
if (!aIsReserve && bIsReserve) return -1;
if (!aIsReserve && !bIsReserve) {
const aGroup = classify(a);
const bGroup = classify(b);
const aIdx = groupOrder.indexOf(aGroup);
const bIdx = groupOrder.indexOf(bGroup);
if (aIdx !== bIdx && aIdx !== -1 && bIdx !== -1) return aIdx - bIdx;
}
return (b.æ›´æ–°æ—¶é—´_ts || 0) - (a.æ›´æ–°æ—¶é—´_ts || 0);
});
}
}
const headers = ["x>=100", "80<=x<100", "50<=x<80", "30<=x<50", "x<30", "æš‚åœæ¥å•"];
const table = document.getElementById("groupSortTable");
let html = "<thead><tr>";
for (let i = 0; i < 6; i++) {
html += `<th colspan="2" class="group-header">${headers[i]}</th>`;
}
html += "</tr></thead><tbody>";
const maxRows = Math.max(...groups.slice(1).map(g => g.length), 0);
for (let r = 0; r < maxRows; r++) {
html += "<tr>";
for (let g = 1; g <= 6; g++) {
if (r < groups[g].length) {
const item = groups[g][r];
html += `<td style="${getCellStyle(item, g)}">${item.ç¾¤æ˜µç§°}</td>`;
html += `<td style="${getCellStyle(item, g)}">${item.ä¹¦å¸}</td>`;
} else {
html += "<td></td><td></td>";
}
}
html += "</tr>";
}
html += "</tbody>";
if (maxRows === 0) {
html = "<tbody><tr><td colspan='12' style='text-align:center;padding:20px;color:#999;'>æš‚æ— æ•°æ®ï¼Œè¯·å…ˆåœ¨æŸ¥è¯¢é¡µç²˜è´´è¡¨æ ¼</td></tr></tbody>";
}
table.innerHTML = html;
renderGroupSortLegend();
const btn = document.getElementById("groupSortGenerateBtn");
if (allItems.length > 0) {
btn.style.display = "inline-block";
} else {
btn.style.display = "none";
}
}
function getCellStyle(item, groupId) {
let style = "";
const isReserve = item.æ˜¯å¦æš‚åœ && (item.ä¹¦å¸.includes("é¢„å®š") || item.ä¹¦å¸.includes("é¢„è®¢"));
if (item.æ˜¯å¦è¿‡æœŸ) {
style += "color:#ff0000;font-weight:bold;";
} else if (isReserve) {
style += "background-color:#e6e6e6;color:#646464;";
} else if (item.æ˜¯å¦æš‚åœ) {
style += "background-color:#e6e6e6;color:#646464;";
} else {
const group = classify(item);
switch (group) {
case 'æ­£å¸¸ç»„': style += "color:#333;font-weight:bold;"; break;
case 'ä½é€Ÿç»„': style += "color:#336699;"; break;
case 'æ”’å¸ç»„': style += "color:#969696;"; break;
case 'ä½åˆ†ç»„': style += "color:#aaa;"; break;
case 'å¼ƒç½®ç»„': style += "color:#aaa;"; break;
}
const num = item.æ•°å€¼;
if (num >= 100) {
style += "background-color:rgb(255, 150, 150);";
} else if (num >= 80) {
style += "background-color:rgb(255, 200, 150);";
} else if (num >= 50) {
style += "background-color:rgb(255, 255, 200);";
} else if (num >= 30) {
style += "background-color:rgb(200, 255, 200);";
} else {
style += "background-color:rgb(200, 220, 255);";
}
}
return style;
}
function renderGroupSortLegend() {
const legend = document.getElementById("groupSortLegend");
legend.innerHTML = `
<div class="legend-item"><span style="color:#ff0000;font-weight:bold;">å³å°†è¿‡æœŸ</span></div>
<div class="legend-item"><span style="color:#336699;">ä¸æ¥æ€¥å•</span></div>
<div class="legend-item"><span style="color:#969696;">æ”’å¸ä¸­</span></div>
<div class="legend-item"><span style="color:#aaa;">ä¿¡ç”¨åˆ†ä½äº8åˆ†</span></div>
`;
}
async function generateGroupSortImage() {
const table = document.getElementById("groupSortTable");
const legend = document.getElementById("groupSortLegend");
if (!table || table.rows.length === 0) {
showPopup("æ— æ•°æ®å¯æˆªå›¾");
return;
}
const wrapper = document.createElement('div');
wrapper.style.width = '1200px';
wrapper.style.padding = '12px';
wrapper.style.background = '#fff';
wrapper.style.position = 'absolute';
wrapper.style.left = '-9999px';
wrapper.style.boxSizing = 'border-box';
wrapper.style.fontFamily = 'Arial, sans-serif';
wrapper.style.fontSize = '12px';
const title = document.createElement('h2');
title.textContent = 'ğŸ“Š åˆ†ç»„æ’åºè¡¨';
title.style.marginTop = '0';
title.style.marginBottom = '10px';
wrapper.appendChild(title);
const clone = table.cloneNode(true);
clone.style.width = '100%';
clone.style.borderCollapse = 'collapse';
wrapper.appendChild(clone);
const legendClone = legend.cloneNode(true);
legendClone.style.marginTop = '20px';
wrapper.appendChild(legendClone);
document.body.appendChild(wrapper);
const canvas = await html2canvas(wrapper, {
backgroundColor: '#fff',
scale: 2
});
const dataUrl = canvas.toDataURL('image/png');
document.body.removeChild(wrapper);
const imgEl = document.getElementById("generatedImg");
imgEl.src = dataUrl;
imgEl.style.maxWidth = '1200px';
imgEl.style.width = 'auto';
imgEl.style.height = 'auto';
imgEl.style.borderRadius = '6px';
imgEl.style.boxShadow = '0 0 8px rgba(0,0,0,0.3)';
const tipEl = document.getElementById("imgTip");
if (/Android|iPhone/i.test(navigator.userAgent)) {
tipEl.innerText = "å¤åˆ¶å¤±è´¥æ—¶å¯é•¿æŒ‰å›¾ç‰‡å¤åˆ¶æˆ–ä¿å­˜";
} else {
tipEl.innerText = "å¤åˆ¶å¤±è´¥æ—¶å¯å³é”®å•å‡»å›¾ç‰‡å¤åˆ¶æˆ–ä¿å­˜";
}
const popup = document.getElementById("imgPopup");
popup.style.display = "flex";
window.currentGroupSortImg = dataUrl;
popup.onclick = function(e) {
if (e.target === popup || e.target.classList.contains('popup-background')) {
popup.style.display = "none";
}
};
const popupContent = popup.querySelector('div');
if (popupContent) {
popupContent.onclick = function(e) {
e.stopPropagation();
};
}
}
async function copyGroupSortImg() {
const table = document.getElementById("groupSortTable");
const legend = document.getElementById("groupSortLegend");
if (!table || table.rows.length === 0) return;
const wrapper = document.createElement('div');
wrapper.style.width = '1200px';
wrapper.style.padding = '12px';
wrapper.style.background = '#fff';
wrapper.style.position = 'absolute';
wrapper.style.left = '-9999px';
wrapper.style.boxSizing = 'border-box';
wrapper.style.fontFamily = 'Arial, sans-serif';
wrapper.style.fontSize = '12px';
const title = document.createElement('h2');
title.textContent = 'ğŸ“Š åˆ†ç»„æ’åºè¡¨';
title.style.marginTop = '0';
title.style.marginBottom = '10px';
wrapper.appendChild(title);
const clone = table.cloneNode(true);
clone.style.width = '100%';
clone.style.borderCollapse = 'collapse';
wrapper.appendChild(clone);
const legendClone = legend.cloneNode(true);
legendClone.style.marginTop = '20px';
wrapper.appendChild(legendClone);
document.body.appendChild(wrapper);
const canvas = await html2canvas(wrapper, {
backgroundColor: '#fff',
scale: 2
});
const blob = await new Promise(resolve => canvas.toBlob(resolve));
document.body.removeChild(wrapper);
try {
await navigator.clipboard.write([new ClipboardItem({
"image/png": blob
})]);
showPopup("å·²å¤åˆ¶å›¾ç‰‡ï¼Œå¯ç›´æ¥ç²˜è´´åˆ°å¾®ä¿¡");
} catch (err) {
showPopup("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶å›¾ç‰‡");
console.error(err);
}
}
function saveGroupSortImg() {
const img = document.getElementById("generatedImg");
if (!img.src) return showPopup("æ— å›¾ç‰‡å¯ä¿å­˜");
const link = document.createElement("a");
link.href = img.src;
link.download = "åˆ†ç»„æ’åºè¡¨.png";
link.click();
}
document.getElementById("groupSortGenerateBtn")?.addEventListener("click", generateGroupSortImage);
const inputDataEl = document.getElementById('inputData');
let inputTimer = null;
inputDataEl.addEventListener('input', () => {
if (inputTimer) clearTimeout(inputTimer);
inputTimer = setTimeout(() => {
if (document.getElementById("groupSortPage").classList.contains("active")) {
updateGroupSortTable();
}
}, 300);
});
</script>
</body></html>


